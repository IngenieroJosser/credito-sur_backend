generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Usuario {
  id                      String                     @id @default(uuid())
  nombreUsuario           String                     @unique @db.VarChar(50)
  correo                  String                     @unique @db.VarChar(255)
  hashContrasena          String                     @db.VarChar(255)
  nombres                 String                     @db.VarChar(100)
  apellidos               String                     @db.VarChar(100)
  telefono                String?                    @db.VarChar(20)
  rol                     RolUsuario
  esPrincipal             Boolean                    @default(false)
  estado                  EstadoUsuario              @default(ACTIVO)
  ultimoIngreso           DateTime?
  intentosFallidos        Int                        @default(0)
  debeCambiarContrasena   Boolean                    @default(false)
  creadoPorId             String?
  creadoEn                DateTime                   @default(now())
  actualizadoEn           DateTime                   @updatedAt
  eliminadoEn             DateTime?
  estadoSincronizacion    EstadoSincronizacion       @default(PENDIENTE)
  ultimaSincronizacion    DateTime?
  errorSincronizacion     String?
  clientesListaNegra      Cliente[]                  @relation("ClienteListaNegraPor")
  clientesAprobados       Cliente[]                  @relation("ClienteAprobadoPor")
  clientesCreados         Cliente[]                  @relation("ClienteCreadoPor")
  gastosAprobados         Gasto[]                    @relation("GastoAprobadoPor")
  gastosReportados        Gasto[]                    @relation("GastoReportadoPor")
  pagosRegistrados        Pago[]
  prestamosAprobados      Prestamo[]                 @relation("PrestamoAprobadoPor")
  prestamosCreados        Prestamo[]                 @relation("PrestamoCreadoPor")
  transaccionesAprobadas  Transaccion[]              @relation("TransaccionAprobadaPor")
  transaccionesCreadas    Transaccion[]              @relation("TransaccionCreadaPor")
  creadoPor               Usuario?                   @relation("UsuarioCreadoPor", fields: [creadoPorId], references: [id])
  usuariosCreados         Usuario[]                  @relation("UsuarioCreadoPor")
  aprobacionesRevisadas   Aprobacion[]               @relation("AprobacionRevisadaPor")
  aprobacionesSolicitadas Aprobacion[]               @relation("AprobacionSolicitadaPor")
  permisosPersonalizados  AsignacionPermisoUsuario[]
  asignacionesRoles       AsignacionRolUsuario[]
  asignacionesRuta        AsignacionRuta[]
  cajasResponsable        Caja[]
  itemsColaSincronizacion ColaSincronizacion[]
  extensionesPago         ExtensionPago[]
  archivosSubidos         Multimedia[]               @relation("MultimediaSubidoPor")
  archivosAsociados       Multimedia[]               @relation("MultimediaUsuario")
  notificaciones          Notificacion[]
  pushSubscriptions       PushSubscription[]
  registrosAuditoria      RegistroAuditoria[]
  rutasComoCobrador       Ruta[]                     @relation("RutaCobrador")
  rutasComoSupervisor     Ruta[]                     @relation("RutaSupervisor")

  @@index([nombreUsuario])
  @@index([correo])
  @@index([rol])
  @@index([estado])
  @@index([estadoSincronizacion])
}

model Notificacion {
  id        String   @id @default(uuid())
  usuarioId String
  titulo    String   @db.VarChar(100)
  mensaje   String
  leida     Boolean  @default(false)
  tipo      String   @default("INFO")
  entidad   String?
  entidadId String?
  metadata  Json?
  creadoEn  DateTime @default(now())
  archivar  Boolean  @default(false)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])

  @@index([usuarioId])
  @@index([leida])
  @@map("notificaciones")
}

model Rol {
  id                  String                 @id @default(uuid())
  nombre              String                 @unique @db.VarChar(50)
  descripcion         String?                @db.VarChar(255)
  esSistema           Boolean                @default(false)
  rutaDefault         String?                @db.VarChar(100)
  creadoEn            DateTime               @default(now())
  actualizadoEn       DateTime               @updatedAt
  eliminadoEn         DateTime?
  asignacionesUsuario AsignacionRolUsuario[]
  permisos            RolPermiso[]

  @@index([nombre])
  @@map("roles")
}

model Permiso {
  id                   String                     @id @default(uuid())
  modulo               String                     @db.VarChar(50)
  accion               String                     @db.VarChar(50)
  nombre               String                     @db.VarChar(100)
  descripcion          String?                    @db.VarChar(255)
  icono                String?                    @db.VarChar(50)
  ruta                 String?                    @db.VarChar(200)
  orden                Int                        @default(0)
  esNavegable          Boolean                    @default(true)
  creadoEn             DateTime                   @default(now())
  actualizadoEn        DateTime                   @updatedAt
  asignacionesUsuarios AsignacionPermisoUsuario[]
  rolesPermisos        RolPermiso[]

  @@unique([modulo, accion])
  @@index([modulo])
  @@map("permisos")
}

model RolPermiso {
  id        String   @id @default(uuid())
  rolId     String
  permisoId String
  creadoEn  DateTime @default(now())
  permiso   Permiso  @relation(fields: [permisoId], references: [id])
  rol       Rol      @relation(fields: [rolId], references: [id])

  @@unique([rolId, permisoId])
  @@map("roles_permisos")
}

model AsignacionRolUsuario {
  id        String    @id @default(uuid())
  usuarioId String
  rolId     String
  creadoEn  DateTime  @default(now())
  expiraEn  DateTime?
  rol       Rol       @relation(fields: [rolId], references: [id])
  usuario   Usuario   @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, rolId])
  @@index([usuarioId])
  @@map("asignaciones_roles_usuarios")
}

model AsignacionPermisoUsuario {
  id        String   @id @default(uuid())
  usuarioId String
  permisoId String
  creadoEn  DateTime @default(now())
  permiso   Permiso  @relation(fields: [permisoId], references: [id])
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, permisoId])
  @@map("asignaciones_permisos_usuarios")
}

model Cliente {
  id                        String               @id @default(uuid())
  codigo                    String               @unique @db.VarChar(20)
  dni                       String               @unique @db.VarChar(20)
  nombres                   String               @db.VarChar(100)
  apellidos                 String               @db.VarChar(100)
  correo                    String?              @db.VarChar(255)
  telefono                  String               @db.VarChar(20)
  direccion                 String?
  referencia                String?
  nivelRiesgo               NivelRiesgo          @default(VERDE)
  puntaje                   Int                  @default(100)
  ultimaActualizacionRiesgo DateTime?
  enListaNegra              Boolean              @default(false)
  razonListaNegra           String?
  fechaListaNegra           DateTime?
  agregadoListaNegraPorId   String?
  creadoPorId               String
  aprobadoPorId             String?
  estadoAprobacion          EstadoAprobacion     @default(PENDIENTE)
  categoriaId               String?
  creadoEn                  DateTime             @default(now())
  actualizadoEn             DateTime             @updatedAt
  eliminadoEn               DateTime?
  estadoSincronizacion      EstadoSincronizacion @default(PENDIENTE)
  ultimaSincronizacion      DateTime?
  agregadoListaNegraPor     Usuario?             @relation("ClienteListaNegraPor", fields: [agregadoListaNegraPorId], references: [id])
  aprobadoPor               Usuario?             @relation("ClienteAprobadoPor", fields: [aprobadoPorId], references: [id])
  categoria                 Categoria?           @relation(fields: [categoriaId], references: [id])
  creadoPor                 Usuario              @relation("ClienteCreadoPor", fields: [creadoPorId], references: [id])
  pagos                     Pago[]
  prestamos                 Prestamo[]
  asignacionesRuta          AsignacionRuta[]
  archivos                  Multimedia[]         @relation("MultimediaCliente")

  @@index([dni])
  @@index([nivelRiesgo])
  @@index([enListaNegra])
  @@index([estadoAprobacion])
  @@index([creadoPorId])
  @@index([estadoSincronizacion])
}

model Producto {
  id            String           @id @default(uuid())
  codigo        String           @unique @db.VarChar(50)
  nombre        String           @db.VarChar(255)
  descripcion   String?
  categoria     String           @db.VarChar(100)
  marca         String?          @db.VarChar(100)
  modelo        String?          @db.VarChar(100)
  costo         Decimal          @db.Decimal(10, 2)
  stock         Int              @default(0)
  stockMinimo   Int              @default(0)
  activo        Boolean          @default(true)
  categoriaId   String?
  creadoEn      DateTime         @default(now())
  actualizadoEn DateTime         @updatedAt
  eliminadoEn   DateTime?
  prestamos     Prestamo[]
  categoriaRel  Categoria?       @relation(fields: [categoriaId], references: [id])
  archivos      Multimedia[]     @relation("MultimediaProducto")
  precios       PrecioProducto[]

  @@index([codigo])
  @@index([categoria])
  @@index([activo])
}

model PrecioProducto {
  id            String     @id @default(uuid())
  productoId    String
  meses         Int
  precio        Decimal    @db.Decimal(10, 2)
  activo        Boolean    @default(true)
  creadoEn      DateTime   @default(now())
  actualizadoEn DateTime   @updatedAt
  prestamos     Prestamo[] @relation("PrecioProductoPrestamos")
  producto      Producto   @relation(fields: [productoId], references: [id])

  @@unique([productoId, meses])
  @@index([productoId])
  @@index([meses])
  @@map("precios_productos")
}

model Prestamo {
  id                   String               @id @default(uuid())
  numeroPrestamo       String               @unique @db.VarChar(50)
  clienteId            String
  productoId           String?
  precioProductoId     String?
  tipoPrestamo         String               @db.VarChar(20)
  tipoAmortizacion     TipoAmortizacion     @default(INTERES_SIMPLE)
  monto                Decimal              @db.Decimal(12, 2)
  tasaInteres          Decimal              @db.Decimal(5, 2)
  tasaInteresMora      Decimal              @db.Decimal(5, 2)
  plazoMeses           Int
  frecuenciaPago       FrecuenciaPago
  cantidadCuotas       Int
  fechaInicio          DateTime
  fechaPrimerCobro     DateTime?
  fechaFin             DateTime
  estado               EstadoPrestamo       @default(BORRADOR)
  creadoPorId          String
  aprobadoPorId        String?
  estadoAprobacion     EstadoAprobacion     @default(PENDIENTE)
  interesTotal         Decimal              @default(0) @db.Decimal(12, 2)
  totalPagado          Decimal              @default(0) @db.Decimal(12, 2)
  capitalPagado        Decimal              @default(0) @db.Decimal(12, 2)
  interesPagado        Decimal              @default(0) @db.Decimal(12, 2)
  interesMoraPagado    Decimal              @default(0) @db.Decimal(12, 2)
  saldoPendiente       Decimal              @default(0) @db.Decimal(12, 2)
  creadoEn             DateTime             @default(now())
  actualizadoEn        DateTime             @updatedAt
  eliminadoEn          DateTime?
  estadoSincronizacion EstadoSincronizacion @default(PENDIENTE)
  ultimaSincronizacion DateTime?
  cuotaInicial         Decimal              @default(0) @db.Decimal(12, 2)
  notas                String?
  garantia             String?
  pagos                Pago[]
  aprobadoPor          Usuario?             @relation("PrestamoAprobadoPor", fields: [aprobadoPorId], references: [id])
  cliente              Cliente              @relation(fields: [clienteId], references: [id])
  creadoPor            Usuario              @relation("PrestamoCreadoPor", fields: [creadoPorId], references: [id])
  precioProducto       PrecioProducto?      @relation("PrecioProductoPrestamos", fields: [precioProductoId], references: [id])
  producto             Producto?            @relation(fields: [productoId], references: [id])
  cuotas               Cuota[]
  extensiones          ExtensionPago[]
  archivos             Multimedia[]         @relation("MultimediaPrestamo")

  @@index([numeroPrestamo])
  @@index([clienteId])
  @@index([estado])
  @@index([estadoAprobacion])
  @@index([creadoPorId])
  @@index([estadoSincronizacion])
  @@index([fechaInicio])
  @@index([fechaFin])
}

model Cuota {
  id                       String         @id @default(uuid())
  prestamoId               String
  numeroCuota              Int
  fechaVencimiento         DateTime
  monto                    Decimal        @db.Decimal(10, 2)
  montoCapital             Decimal        @db.Decimal(10, 2)
  montoInteres             Decimal        @db.Decimal(10, 2)
  montoInteresMora         Decimal        @default(0) @db.Decimal(10, 2)
  estado                   EstadoCuota    @default(PENDIENTE)
  montoPagado              Decimal        @default(0) @db.Decimal(10, 2)
  fechaPago                DateTime?
  fechaVencimientoProrroga DateTime?
  extensionId              String?        @unique
  creadoEn                 DateTime       @default(now())
  actualizadoEn            DateTime       @updatedAt
  extension                ExtensionPago? @relation(fields: [extensionId], references: [id])
  prestamo                 Prestamo       @relation(fields: [prestamoId], references: [id])
  detallesPago             DetallePago[]

  @@unique([prestamoId, numeroCuota])
  @@index([prestamoId])
  @@index([fechaVencimiento])
  @@index([estado])
  @@index([fechaVencimientoProrroga])
  @@map("cuotas")
}

model ExtensionPago {
  id                       String   @id @default(uuid())
  prestamoId               String
  cuotaId                  String?  @unique
  fechaVencimientoOriginal DateTime
  nuevaFechaVencimiento    DateTime
  razon                    String?
  aprobadoPorId            String
  creadoEn                 DateTime @default(now())
  actualizadoEn            DateTime @updatedAt
  cuota                    Cuota?
  aprobadoPor              Usuario  @relation(fields: [aprobadoPorId], references: [id])
  prestamo                 Prestamo @relation(fields: [prestamoId], references: [id])

  @@index([prestamoId])
  @@index([aprobadoPorId])
  @@map("extensiones_pago")
}

model Pago {
  id                   String               @id @default(uuid())
  numeroPago           String               @unique @db.VarChar(50)
  clienteId            String
  prestamoId           String
  cobradorId           String
  fechaPago            DateTime             @default(now())
  montoTotal           Decimal              @db.Decimal(10, 2)
  metodoPago           MetodoPago
  numeroReferencia     String?              @db.VarChar(100)
  notas                String?
  creadoEn             DateTime             @default(now())
  actualizadoEn        DateTime             @updatedAt
  estadoSincronizacion EstadoSincronizacion @default(PENDIENTE)
  ultimaSincronizacion DateTime?
  cliente              Cliente              @relation(fields: [clienteId], references: [id])
  cobrador             Usuario              @relation(fields: [cobradorId], references: [id])
  prestamo             Prestamo             @relation(fields: [prestamoId], references: [id])
  detalles             DetallePago[]
  archivos             Multimedia[]         @relation("MultimediaPago")
  recibo               Recibo?

  @@index([numeroPago])
  @@index([clienteId])
  @@index([prestamoId])
  @@index([cobradorId])
  @@index([fechaPago])
  @@index([estadoSincronizacion])
}

model DetallePago {
  id               String   @id @default(uuid())
  pagoId           String
  cuotaId          String
  monto            Decimal  @db.Decimal(10, 2)
  montoCapital     Decimal  @db.Decimal(10, 2)
  montoInteres     Decimal  @db.Decimal(10, 2)
  montoInteresMora Decimal  @db.Decimal(10, 2)
  creadoEn         DateTime @default(now())
  cuota            Cuota    @relation(fields: [cuotaId], references: [id])
  pago             Pago     @relation(fields: [pagoId], references: [id])

  @@unique([pagoId, cuotaId])
  @@index([pagoId])
  @@index([cuotaId])
  @@map("detalles_pago")
}

model Recibo {
  id              String       @id @default(uuid())
  pagoId          String       @unique
  numeroRecibo    String       @unique @db.VarChar(50)
  contenido       Json
  rutaPDF         String?      @db.VarChar(500)
  compartidoVia   String?      @db.VarChar(50)
  fechaCompartido DateTime?
  creadoEn        DateTime     @default(now())
  actualizadoEn   DateTime     @updatedAt
  archivos        Multimedia[] @relation("MultimediaRecibo")
  pago            Pago         @relation(fields: [pagoId], references: [id])

  @@index([numeroRecibo])
  @@index([pagoId])
  @@map("recibos")
}

model Ruta {
  id            String           @id @default(uuid())
  codigo        String           @unique @db.VarChar(20)
  nombre        String           @db.VarChar(255)
  descripcion   String?
  zona          String           @db.VarChar(100)
  activa        Boolean          @default(true)
  cobradorId    String
  supervisorId  String?
  eliminadoEn   DateTime?
  creadoEn      DateTime         @default(now())
  actualizadoEn DateTime         @updatedAt
  gastos        Gasto[]
  asignaciones  AsignacionRuta[]
  cajas         Caja[]
  cobrador      Usuario          @relation("RutaCobrador", fields: [cobradorId], references: [id])
  supervisor    Usuario?         @relation("RutaSupervisor", fields: [supervisorId], references: [id])

  @@index([codigo])
  @@index([cobradorId])
  @@index([supervisorId])
  @@index([activa])
  @@map("rutas")
}

model AsignacionRuta {
  id              String    @id @default(uuid())
  rutaId          String
  clienteId       String
  cobradorId      String
  diaSemana       Int?
  fechaEspecifica DateTime?
  ordenVisita     Int       @default(0)
  activa          Boolean   @default(true)
  creadoEn        DateTime  @default(now())
  actualizadoEn   DateTime  @updatedAt
  cliente         Cliente   @relation(fields: [clienteId], references: [id])
  cobrador        Usuario   @relation(fields: [cobradorId], references: [id])
  ruta            Ruta      @relation(fields: [rutaId], references: [id])

  @@unique([rutaId, clienteId, fechaEspecifica])
  @@index([rutaId])
  @@index([clienteId])
  @@index([cobradorId])
  @@index([diaSemana])
  @@index([fechaEspecifica])
  @@index([ordenVisita])
  @@map("asignaciones_rutas")
}

model Aprobacion {
  id                   String               @id @default(uuid())
  tipoAprobacion       TipoAprobacion
  referenciaId         String
  tablaReferencia      String               @db.VarChar(50)
  solicitadoPorId      String
  datosSolicitud       Json
  aprobadoPorId        String?
  estado               EstadoAprobacion     @default(PENDIENTE)
  comentarios          String?
  datosAprobados       Json?
  creadoEn             DateTime             @default(now())
  actualizadoEn        DateTime             @updatedAt
  revisadoEn           DateTime?
  estadoSincronizacion EstadoSincronizacion @default(PENDIENTE)
  montoSolicitud       Decimal?             @db.Decimal(12, 2)
  aprobadoPor          Usuario?             @relation("AprobacionRevisadaPor", fields: [aprobadoPorId], references: [id])
  solicitadoPor        Usuario              @relation("AprobacionSolicitadaPor", fields: [solicitadoPorId], references: [id])

  @@index([tipoAprobacion])
  @@index([referenciaId, tablaReferencia])
  @@index([solicitadoPorId])
  @@index([aprobadoPorId])
  @@index([estado])
  @@index([creadoEn])
  @@index([estadoSincronizacion])
  @@map("aprobaciones")
}

model Caja {
  id            String        @id @default(uuid())
  codigo        String        @unique @db.VarChar(20)
  nombre        String        @db.VarChar(255)
  tipo          TipoCaja
  rutaId        String?
  saldoActual   Decimal       @default(0) @db.Decimal(12, 2)
  saldoMinimo   Decimal       @default(0) @db.Decimal(12, 2)
  saldoMaximo   Decimal       @default(0) @db.Decimal(12, 2)
  activa        Boolean       @default(true)
  responsableId String
  creadoEn      DateTime      @default(now())
  actualizadoEn DateTime      @updatedAt
  gastos        Gasto[]
  transacciones Transaccion[]
  responsable   Usuario       @relation(fields: [responsableId], references: [id])
  ruta          Ruta?         @relation(fields: [rutaId], references: [id])

  @@index([codigo])
  @@index([tipo])
  @@index([rutaId])
  @@index([responsableId])
  @@map("cajas")
}

model Transaccion {
  id                   String               @id @default(uuid())
  numeroTransaccion    String               @unique @db.VarChar(50)
  cajaId               String
  tipo                 TipoTransaccion
  monto                Decimal              @db.Decimal(12, 2)
  tipoReferencia       String?              @db.VarChar(50)
  referenciaId         String?
  descripcion          String
  notas                String?
  creadoPorId          String
  aprobadoPorId        String?
  fechaTransaccion     DateTime             @default(now())
  creadoEn             DateTime             @default(now())
  actualizadoEn        DateTime             @updatedAt
  estadoSincronizacion EstadoSincronizacion @default(PENDIENTE)
  aprobadoPor          Usuario?             @relation("TransaccionAprobadaPor", fields: [aprobadoPorId], references: [id])
  caja                 Caja                 @relation(fields: [cajaId], references: [id])
  creadoPor            Usuario              @relation("TransaccionCreadaPor", fields: [creadoPorId], references: [id])

  @@index([numeroTransaccion])
  @@index([cajaId])
  @@index([tipo])
  @@index([tipoReferencia, referenciaId])
  @@index([creadoPorId])
  @@index([fechaTransaccion])
  @@index([estadoSincronizacion])
}

model Gasto {
  id                   String               @id @default(uuid())
  numeroGasto          String               @unique @db.VarChar(50)
  rutaId               String?
  cobradorId           String
  cajaId               String
  tipoGasto            TipoGasto
  monto                Decimal              @db.Decimal(10, 2)
  descripcion          String
  fotoRecibo           String?              @db.VarChar(500)
  aprobadoPorId        String?
  estadoAprobacion     EstadoAprobacion     @default(PENDIENTE)
  categoriaId          String?
  fechaGasto           DateTime             @default(now())
  creadoEn             DateTime             @default(now())
  actualizadoEn        DateTime             @updatedAt
  estadoSincronizacion EstadoSincronizacion @default(PENDIENTE)
  aprobadoPor          Usuario?             @relation("GastoAprobadoPor", fields: [aprobadoPorId], references: [id])
  caja                 Caja                 @relation(fields: [cajaId], references: [id])
  categoria            Categoria?           @relation(fields: [categoriaId], references: [id])
  cobrador             Usuario              @relation("GastoReportadoPor", fields: [cobradorId], references: [id])
  ruta                 Ruta?                @relation(fields: [rutaId], references: [id])
  archivos             Multimedia[]         @relation("MultimediaGasto")

  @@index([numeroGasto])
  @@index([rutaId])
  @@index([cobradorId])
  @@index([estadoAprobacion])
  @@index([fechaGasto])
  @@index([estadoSincronizacion])
}

model RegistroAuditoria {
  id                String      @id @default(uuid())
  usuarioId         String?
  rolUsuario        RolUsuario?
  accion            String      @db.VarChar(100)
  entidad           String      @db.VarChar(50)
  entidadId         String?
  valoresAnteriores Json?
  valoresNuevos     Json?
  cambios           Json?
  direccionIP       String?     @db.VarChar(45)
  agenteUsuario     String?
  endpoint          String?     @db.VarChar(500)
  creadoEn          DateTime    @default(now())
  usuario           Usuario?    @relation(fields: [usuarioId], references: [id])

  @@index([usuarioId])
  @@index([accion])
  @@index([entidad, entidadId])
  @@index([creadoEn])
  @@map("registros_auditoria")
}

model ColaSincronizacion {
  id                 String               @id @default(uuid())
  nombreTabla        String               @db.VarChar(50)
  idRegistro         String
  operacion          String               @db.VarChar(10)
  datos              Json
  estado             EstadoSincronizacion @default(PENDIENTE)
  intentos           Int                  @default(0)
  ultimoIntento      DateTime?
  mensajeError       String?
  dispositivoCreador String?              @db.VarChar(100)
  usuarioCreadorId   String?
  creadoEn           DateTime             @default(now())
  actualizadoEn      DateTime             @updatedAt
  usuarioCreador     Usuario?             @relation(fields: [usuarioCreadorId], references: [id])

  @@index([nombreTabla, idRegistro])
  @@index([estado])
  @@index([creadoEn])
  @@map("cola_sincronizacion")
}

model Multimedia {
  id                   String                  @id @default(uuid())
  clienteId            String?
  prestamoId           String?
  pagoId               String?
  gastoId              String?
  usuarioId            String?
  productoId           String?
  reciboId             String?
  entidad              String?                 @db.VarChar(50)
  tipoContenido        TipoContenidoMultimedia
  tipoArchivo          String                  @db.VarChar(50)
  formato              String                  @db.VarChar(10)
  nombreOriginal       String                  @db.VarChar(255)
  nombreAlmacenamiento String                  @db.VarChar(255)
  ruta                 String                  @db.VarChar(500)
  url                  String?                 @db.VarChar(500)
  tamanoBytes          Int                     @default(0)
  ancho                Int?
  alto                 Int?
  duracion             Int?
  descripcion          String?
  etiquetas            String?                 @db.VarChar(255)
  esPublico            Boolean                 @default(false)
  esPrincipal          Boolean                 @default(false)
  estado               EstadoMultimedia        @default(ACTIVO)
  subidoPorId          String
  creadoEn             DateTime                @default(now())
  actualizadoEn        DateTime                @updatedAt
  eliminadoEn          DateTime?
  estadoSincronizacion EstadoSincronizacion    @default(PENDIENTE)
  ultimaSincronizacion DateTime?
  hashArchivo          String?                 @db.VarChar(64)
  cliente              Cliente?                @relation("MultimediaCliente", fields: [clienteId], references: [id], onDelete: Cascade)
  gasto                Gasto?                  @relation("MultimediaGasto", fields: [gastoId], references: [id], onDelete: Cascade)
  pago                 Pago?                   @relation("MultimediaPago", fields: [pagoId], references: [id], onDelete: Cascade)
  prestamo             Prestamo?               @relation("MultimediaPrestamo", fields: [prestamoId], references: [id], onDelete: Cascade)
  producto             Producto?               @relation("MultimediaProducto", fields: [productoId], references: [id], onDelete: Cascade)
  recibo               Recibo?                 @relation("MultimediaRecibo", fields: [reciboId], references: [id], onDelete: Cascade)
  subidoPor            Usuario                 @relation("MultimediaSubidoPor", fields: [subidoPorId], references: [id])
  usuario              Usuario?                @relation("MultimediaUsuario", fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([clienteId])
  @@index([prestamoId])
  @@index([pagoId])
  @@index([gastoId])
  @@index([usuarioId])
  @@index([productoId])
  @@index([reciboId])
  @@index([tipoContenido])
  @@index([subidoPorId])
  @@index([esPrincipal])
  @@index([estado])
  @@index([creadoEn])
  @@index([estadoSincronizacion])
  @@map("multimedia")
}

model Categoria {
  id            String     @id @default(uuid())
  nombre        String     @db.VarChar(100)
  descripcion   String?
  tipo          String     @db.VarChar(50)
  color         String?    @db.VarChar(20)
  activa        Boolean    @default(true)
  creadoEn      DateTime   @default(now())
  actualizadoEn DateTime   @updatedAt
  eliminadoEn   DateTime?
  clientes      Cliente[]
  gastos        Gasto[]
  productos     Producto[]

  @@index([tipo])
  @@map("categorias")
}

model PushSubscription {
  id            String   @id @default(uuid())
  endpoint      String   @unique
  usuarioId     String
  p256dh        String
  auth          String
  activa        Boolean  @default(true)
  creadoEn      DateTime @default(now())
  actualizadoEn DateTime @updatedAt
  usuario       Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("push_subscriptions")
}

enum EstadoUsuario {
  ACTIVO
  INACTIVO
  SUSPENDIDO
}

enum RolUsuario {
  SUPER_ADMINISTRADOR
  ADMIN
  COORDINADOR
  SUPERVISOR
  COBRADOR
  CONTADOR
  PUNTO_DE_VENTA
}

enum NivelRiesgo {
  VERDE
  AMARILLO
  ROJO
  LISTA_NEGRA
}

enum EstadoPrestamo {
  BORRADOR
  PENDIENTE_APROBACION
  ACTIVO
  EN_MORA
  PAGADO
  INCUMPLIDO
  PERDIDA
}

enum EstadoCuota {
  PENDIENTE
  PAGADA
  PARCIAL
  VENCIDA
  PRORROGADA
}

enum FrecuenciaPago {
  DIARIO
  SEMANAL
  QUINCENAL
  MENSUAL
}

enum TipoAmortizacion {
  INTERES_SIMPLE
  FRANCESA
}

enum MetodoPago {
  EFECTIVO
  TRANSFERENCIA
}

enum EstadoAprobacion {
  PENDIENTE
  APROBADO
  RECHAZADO
  CANCELADO
}

enum TipoAprobacion {
  NUEVO_CLIENTE
  NUEVO_PRESTAMO
  GASTO
  SOLICITUD_BASE_EFECTIVO
  PRORROGA_PAGO
  BAJA_POR_PERDIDA
}

enum TipoGasto {
  OPERATIVO
  TRANSPORTE
  OTRO
}

enum TipoCaja {
  PRINCIPAL
  RUTA
}

enum TipoTransaccion {
  INGRESO
  EGRESO
  TRANSFERENCIA
}

enum EstadoSincronizacion {
  PENDIENTE
  SINCRONIZADO
  CONFLICTO
  ERROR
}

enum TipoContenidoMultimedia {
  FOTO_PERFIL
  DOCUMENTO_IDENTIDAD_FRENTE
  DOCUMENTO_IDENTIDAD_REVERSO
  COMPROBANTE_DOMICILIO
  FIRMA_DIGITAL
  FOTO_PRODUCTO
  RECIBO_PAGO
  EVIDENCIA_GASTO
  CONTRATO_PRESTAMO
  OTRO_DOCUMENTO
}

enum EstadoMultimedia {
  TEMPORAL
  ACTIVO
  ELIMINADO
}

model ConfiguracionSistema {
  id                    String   @id @default("default")
  autoAprobarClientes   Boolean  @default(false)
  autoAprobarCreditos   Boolean  @default(false)
  tasaInteresBase       Decimal  @default(20.00) @db.Decimal(5, 2)
  porcentajeMoraDiaria  Decimal  @default(2.50) @db.Decimal(5, 2)
  actualizadoEn         DateTime @updatedAt
  actualizadoPorId      String?

  @@map("configuracion_sistema")
}
